<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ol start="6" style="list-style-type: decimal">
<li>Miscellaneous</li>
</ol> • sf</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="&lt;ol start=" style="list-style-type: decimal">
</head>
<body>
<li>Miscellaneous</li>
" /&gt;

<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sf</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.6.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sf1.html">1. Simple Features for R</a>
    </li>
    <li>
      <a href="../articles/sf2.html">2. Reading, Writing and Converting Simple Features</a>
    </li>
    <li>
      <a href="../articles/sf3.html">3. Manipulating Simple Feature Geometries</a>
    </li>
    <li>
      <a href="../articles/sf4.html">4. Manipulating Simple Features</a>
    </li>
    <li>
      <a href="../articles/sf5.html">5. Plotting Simple Features</a>
    </li>
    <li>
      <a href="../articles/sf6.html">6. Miscellaneous</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/sf/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1><ol start="6" style="list-style-type: decimal">
<li>Miscellaneous</li>
</ol></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/sf//blob/master/vignettes/sf6.Rmd"><code>vignettes/sf6.Rmd</code></a></small>
      <div class="hidden name"><code>sf6.Rmd</code></div>

    </div>

    
    
<p>This vignette describes a number of issues that did not come up in the previous vignettes, and that may or may not be categorized as “frequently asked questions”. Readers are encouraged to provide entries for this vignette (as for the others).</p>
<div id="what-is-this-epsg-code-all-about" class="section level1">
<h1 class="hasAnchor">
<a href="#what-is-this-epsg-code-all-about" class="anchor"></a>What is this EPSG code all about?</h1>
<p>EPSG stands for a maintained, well-understood set of spatial reference systems, maintained by the International Association of Oil &amp; Gass Producers (IOGP), and found at <a href="http://epsg.org/">epsg.org</a>. From R, we can get access to the EPSG dataset programatically (as a <code>data.frame</code>) by:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rgdal::<span class="kw">make_EPSG</span>()</code></pre></div>
<p>see also the first vignette.</p>
</div>
<div id="how-does-sf-deal-with-secondary-geometry-columns" class="section level1">
<h1 class="hasAnchor">
<a href="#how-does-sf-deal-with-secondary-geometry-columns" class="anchor"></a>How does <code>sf</code> deal with secondary geometry columns?</h1>
<p><code>sf</code> objects can have more than one geometry list-column, but always only one geometry column is considered <em>active</em>, and returned by <code>st_geometry</code>. When there are multiple geometry columns, the default <code>print</code> methods reports which one is active:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
## Linking to GEOS 3.5.0, GDAL 2.2.2, proj.4 4.8.0
<span class="kw">demo</span>(nc, <span class="dt">ask =</span> <span class="ot">FALSE</span>, <span class="dt">echo =</span> <span class="ot">FALSE</span>)
## Reading layer `nc.gpkg' from data source `/tmp/Rtmp6RHbFm/temp_libpath6ec8267cb58c/sf/gpkg/nc.gpkg' using driver `GPKG'
## Simple feature collection with 100 features and 14 fields
## Attribute-geometry relationship: 0 constant, 8 aggregate, 6 identity
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## epsg (SRID):    4267
## proj4string:    +proj=longlat +datum=NAD27 +no_defs
nc$geom2 =<span class="st"> </span><span class="kw"><a href="../reference/geos_unary.html">st_centroid</a></span>(<span class="kw">st_geometry</span>(nc))
## Warning in st_centroid.sfc(st_geometry(nc)): st_centroid does not give
## correct centroids for longitude/latitude data
<span class="kw">print</span>(nc, <span class="dt">n =</span> <span class="dv">2</span>)
## Simple feature collection with 100 features and 14 fields
## Attribute-geometry relationship: 0 constant, 8 aggregate, 6 identity, 1 NA's
## Active geometry column: geom
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## epsg (SRID):    4267
## proj4string:    +proj=longlat +datum=NAD27 +no_defs
## First 2 features:
##    AREA PERIMETER CNTY_ CNTY_ID      NAME  FIPS FIPSNO CRESS_ID BIR74
## 1 0.114     1.442  1825    1825      Ashe 37009  37009        5  1091
## 2 0.061     1.231  1827    1827 Alleghany 37005  37005        3   487
##   SID74 NWBIR74 BIR79 SID79 NWBIR79                           geom
## 1     1      10  1364     0      19 MULTIPOLYGON (((-81.47276 3...
## 2     0      10   542     3      12 MULTIPOLYGON (((-81.23989 3...
##                        geom2
## 1  POINT (-81.49826 36.4314)
## 2 POINT (-81.12515 36.49101)</code></pre></div>
<p>We can switch the active geometry by using <code>st_geometry&lt;-</code> or <code>st_set_geometry</code>, as in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(nc))</code></pre></div>
<p><img src="sf6_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_geometry</span>(nc) &lt;-<span class="st"> "geom2"</span>
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(nc))</code></pre></div>
<p><img src="sf6_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
</div>
<div id="does-st_simplify-preserve-topology" class="section level1">
<h1 class="hasAnchor">
<a href="#does-st_simplify-preserve-topology" class="anchor"></a>Does <code>st_simplify</code> preserve topology?</h1>
<p><code>st_simplify</code> is a topology-preserving function, but does this on the level of individual feature geometries. That means, simply said, that after applying it, a polygon will still be a polygon. However when two features have a longer shared boundary, applying <code>st_simplify</code> to the object does not guarantee that in the resulting object these two polygons still have the same boundary in common, since the simplification is done independently, <em>for each feature geometry</em>.</p>
</div>
<div id="why-do-dplyr-verbs-not-work-for-sf-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#why-do-dplyr-verbs-not-work-for-sf-objects" class="anchor"></a>Why do dplyr verbs not work for <code>sf</code> objects?</h1>
<p>They do! However, many developers like to write scripts that never load packages but address all functions by the <code>sf::</code> prefix, as in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">i =<span class="st"> </span>sf::<span class="kw"><a href="../reference/geos_binary_pred.html">st_intersects</a></span>(sf1, sf2)</code></pre></div>
<p>This works up to the moment that a <code>dplyr</code> generic like <code>select</code> for an <code>sf</code> object is needed: should one call <code><a href="http://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code> (won’t know it should search in package <code>sf</code>) or <code>sf::select</code> (which doesn’t exist)? Neither works. One should in this case simply load <code>sf</code>, e.g. by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)</code></pre></div>
</div>
<div id="what-is-this-errorwarningmessage-about" class="section level1">
<h1 class="hasAnchor">
<a href="#what-is-this-errorwarningmessage-about" class="anchor"></a>What is this error/warning/message about?</h1>
<div id="although-coordinates-are-longitudelatitude-xxx-assumes-that-they-are-planar" class="section level2">
<h2 class="hasAnchor">
<a href="#although-coordinates-are-longitudelatitude-xxx-assumes-that-they-are-planar" class="anchor"></a><em>although coordinates are longitude/latitude, xxx assumes that they are planar</em>
</h2>
<p>Most (but not all) of the geometry calculating routines used by <code>sf</code> come from the <a href="https://trac.osgeo.org/geos/">GEOS</a> library. This library considers coordinates in a two-dimensional, flat, Euclidian space. For longitude latitude data, this is not the case. A simple example is a polygon enclosing the North pole, which should include the pole:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polygon =<span class="st"> </span><span class="kw"><a href="../reference/sfc.html">st_sfc</a></span>(<span class="kw"><a href="../reference/st.html">st_polygon</a></span>(<span class="kw">list</span>(<span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">80</span>), <span class="kw">c</span>(<span class="dv">120</span>,<span class="dv">80</span>), <span class="kw">c</span>(<span class="dv">240</span>,<span class="dv">80</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">80</span>)))), 
        <span class="dt">crs =</span> <span class="dv">4326</span>)
pole =<span class="st"> </span><span class="kw"><a href="../reference/sfc.html">st_sfc</a></span>(<span class="kw"><a href="../reference/st.html">st_point</a></span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">90</span>)), <span class="dt">crs =</span> <span class="dv">4326</span>)
<span class="kw"><a href="../reference/geos_binary_pred.html">st_intersects</a></span>(polygon, pole)
## although coordinates are longitude/latitude, st_intersects assumes that they are planar
## Sparse geometry binary predicate list of length 1, where the predicate was `intersects'
##  1: (empty)</code></pre></div>
<p>which gives a wrong result (no intersection).</p>
</div>
<div id="st_centroid-does-not-give-correct-centroids-for-longitudelatitude-data" class="section level2">
<h2 class="hasAnchor">
<a href="#st_centroid-does-not-give-correct-centroids-for-longitudelatitude-data" class="anchor"></a><em>st_centroid does not give correct centroids for longitude/latitude data</em>
</h2>
<p>Similar to the above, centroids are computed assuming flat, 2D space:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/geos_unary.html">st_centroid</a></span>(polygon)[[<span class="dv">1</span>]]
## Warning in st_centroid.sfc(polygon): st_centroid does not give correct
## centroids for longitude/latitude data
## POINT (120 80)</code></pre></div>
<p>where the centroid should have been the pole.</p>
</div>
<div id="dist-is-assumed-to-be-in-decimal-degrees-arc_degrees-" class="section level2">
<h2 class="hasAnchor">
<a href="#dist-is-assumed-to-be-in-decimal-degrees-arc_degrees-" class="anchor"></a><em>dist is assumed to be in decimal degrees (arc_degrees).</em>
</h2>
<p>This message indicates that <code>sf</code> assumes a distance value is given in degrees. To avoid this message, pass a value with the right units:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pt =<span class="st"> </span><span class="kw"><a href="../reference/sfc.html">st_sfc</a></span>(<span class="kw"><a href="../reference/st.html">st_point</a></span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), <span class="dt">crs =</span> <span class="dv">4326</span>)
buf =<span class="st"> </span><span class="kw"><a href="../reference/geos_unary.html">st_buffer</a></span>(polygon, <span class="dv">1</span>)
## Warning in st_buffer.sfc(polygon, 1): st_buffer does not correctly buffer
## longitude/latitude data
## dist is assumed to be in decimal degrees (arc_degrees).
buf =<span class="st"> </span><span class="kw"><a href="../reference/geos_unary.html">st_buffer</a></span>(polygon, units::<span class="kw">set_units</span>(<span class="dv">1</span>, degree))
## Warning in st_buffer.sfc(polygon, units::set_units(1, degree)): st_buffer
## does not correctly buffer longitude/latitude data</code></pre></div>
</div>
<div id="both-operands-of-the-expression-should-be-units-objects-or-_error-operator-is-invalid-for-atomic-vectors" class="section level2">
<h2 class="hasAnchor">
<a href="#both-operands-of-the-expression-should-be-units-objects-or-_error-operator-is-invalid-for-atomic-vectors" class="anchor"></a><em>both operands of the expression should be “units” objects</em> or _Error: $ operator is invalid for atomic vectors"</h2>
<p>This message appears if you loaded package <code>spatstat</code> <em>after</em> you loaded <code>sf</code>. For units objects created by package <code>units</code>, methods from <code>spatstat</code> are chosen which also implements a <code>units</code> class. The solution is to revert the order of loading packages: first <code>spatstat</code>, then <code>units</code>. Otherwise, spatstat version 1.53-2.012 should <a href="https://github.com/spatstat/spatstat/issues/63">resolve this</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#what-is-this-epsg-code-all-about">What is this EPSG code all about?</a></li>
      <li><a href="#how-does-sf-deal-with-secondary-geometry-columns">How does <code>sf</code> deal with secondary geometry columns?</a></li>
      <li><a href="#does-st_simplify-preserve-topology">Does <code>st_simplify</code> preserve topology?</a></li>
      <li><a href="#why-do-dplyr-verbs-not-work-for-sf-objects">Why do dplyr verbs not work for <code>sf</code> objects?</a></li>
      <li>
<a href="#what-is-this-errorwarningmessage-about">What is this error/warning/message about?</a><ul class="nav nav-pills nav-stacked">
<li><a href="#although-coordinates-are-longitudelatitude-xxx-assumes-that-they-are-planar"><em>although coordinates are longitude/latitude, xxx assumes that they are planar</em></a></li>
      <li><a href="#st_centroid-does-not-give-correct-centroids-for-longitudelatitude-data"><em>st_centroid does not give correct centroids for longitude/latitude data</em></a></li>
      <li><a href="#dist-is-assumed-to-be-in-decimal-degrees-arc_degrees-"><em>dist is assumed to be in decimal degrees (arc_degrees).</em></a></li>
      <li><a href="#both-operands-of-the-expression-should-be-units-objects-or-_error-operator-is-invalid-for-atomic-vectors"><em>both operands of the expression should be “units” objects</em> or _Error: $ operator is invalid for atomic vectors"</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  
</body>
</html>
